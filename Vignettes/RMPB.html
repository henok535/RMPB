<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Henok Woldu" />

<meta name="date" content="2018-05-21" />

<title>RMPB Package Tutorial</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">RMPB Package Tutorial</h1>
<h4 class="author"><em><a href="http://henokuga@gmail.com">Henok Woldu </a></em></h4>
<h4 class="date"><em>2018-05-21</em></h4>



<div id="summary" class="section level1">
<h1>Summary</h1>
<p>In the medical field, one would always be interested to assess if a new methods or a new instrument can replace an existing one. The motivation for this can be the new method/instrument is less expensive, less time consuming, doesn’t need a highly skilled personnel. However, for the new method/instrument to replace the old (mainly considered as a gold standard), one need to make sure that the new results replicate/reproduce the old results. Package <em>RMPB</em> is used to assess the reproducibility of a predictive biomarker’s clinical utility when an orginal biomarker <span class="math inline">\(X\)</span> is replaced with a modified biomarker <span class="math inline">\(W\)</span>.</p>
<div id="package-description" class="section level2">
<h2>Package description</h2>
<p>The package consisits of several functions that help to caculate the reproducibility metric <span class="math inline">\(\Delta_r\)</span>. This package is written in such a way that users can even generate a hypothetical data using the <strong>datgen</strong> function in case they don not have data at hand. To simulate under different scenarios, users can use the <strong>cl2mp</strong> function to change what we called <em>clinician inputs</em> to <em>model parameters</em>. Estimation of <span class="math inline">\(\Delta_r\)</span> needs estimation of <span class="math inline">\(\Theta_{gs}\)</span> and <span class="math inline">\(\Theta_{mod}\)</span> respectively. <span class="math inline">\(\Theta_{gs}\)</span> is a metric that measures the decrease the proportion of an event of interest as a result of a biomarer guided treatment when the <em>gold standard</em> biomarker is observed and <span class="math inline">\(\Theta_{mod}\)</span> measures the same thing assuming the <em>modified assay (biomarker)</em> is observed.</p>
</div>
<div id="intended-audience-and-goal-of-the-package" class="section level2">
<h2>Intended audience and goal of the package</h2>
<p>The main audience of this package are individuals who want to learn how to evaluate the clinical utility of a predictive biomarker. Though it is not a necessary requirement, but having some basic background about predictive biomarkers and their assesment statistical methods can facilitate understanding this package with ease. Audience who are more interested to know about the statistical methods used can read the paper at…….</p>
</div>
<div id="using-this-package" class="section level2">
<h2>Using this package</h2>
<p>The following sections describe the main steps to follow in order to use this package.</p>
<div id="install-the-package" class="section level3">
<h3>Install the package</h3>
<p>It is not yet on CRAN, but once it is available it can be installed and used as</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;RMPB&quot;</span>)  <span class="co"># install it first </span>
   
<span class="kw">library</span>(RMPB)             <span class="co"># load the package </span></code></pre></div>
<p>The very updated version of this package can be obtained from my <em>github</em> website. To install it from my github, the <code>devtools</code> package is first needed to be install. Here is how you can install it from github:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)  <span class="co"># install the devtools package if you have not done it before.</span>

<span class="kw">library</span>(devtools)            <span class="co"># load the package devtools</span>

<span class="co"># to install the RMPB from my github acount (&quot;henok535/RMPB&quot;)</span>

<span class="kw">install_github</span>(<span class="st">&quot;henok535/RMPB&quot;</span>)

<span class="kw">library</span>(RMPB)     
 
<span class="co"># Well come to RMPB package. It is now ready for use!</span></code></pre></div>
</div>
</div>
<div id="example-of-data-simulation" class="section level2">
<h2>Example of data simulation</h2>
<p>Here we first show how to generate a data fit for the intended purpose. In case one has a repoducibility data set at hand, they can be directly used as long as they are standardized to have the desired column names.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RMPB)   <span class="co"># load the package </span></code></pre></div>
<pre><code>## Loading required package: shiny</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">       dispar &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">4.8</span>, <span class="fl">1.8</span>)  <span class="co"># mean and sd of the predictive biomarker </span>

<span class="co"># change clinician inputs to model parameters</span>

   bmrk &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10000</span>, dispar[<span class="dv">1</span>], dispar[<span class="dv">2</span>]) <span class="co"># generate the biomarker </span>
   bmrkquant &lt;-<span class="st"> </span><span class="kw">quantile</span>(bmrk)              <span class="co"># quantiles of the generated biomarker</span>
   clinInput1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">log</span>(<span class="fl">0.25</span><span class="op">/</span><span class="fl">0.75</span>), <span class="kw">log</span>(<span class="fl">0.75</span><span class="op">/</span><span class="fl">0.25</span>), <span class="kw">log</span>(<span class="fl">0.75</span><span class="op">/</span><span class="fl">0.25</span>), <span class="kw">log</span>(<span class="fl">0.25</span><span class="op">/</span><span class="fl">0.75</span>)) <span class="co"># clinician input values</span>
   coeffmod &lt;-<span class="st"> </span><span class="kw">cl2mp</span>(clinInput1, <span class="kw">c</span>(bmrkquant[<span class="dv">2</span>], bmrkquant[<span class="dv">4</span>]))   <span class="co"># change the clinician inputs to model parameters</span>
 

 <span class="co"># biomarker used to mimic the oncotype Dx recurrence score</span>

     varerr &lt;-<span class="st"> </span><span class="fl">0.6</span>              <span class="co"># variance of the error term</span>
     sderr &lt;-<span class="st"> </span><span class="kw">sqrt</span>(varerr)      <span class="co"># standard deviation of the error term</span>
     coff &lt;-<span class="st"> </span>coeffmod           <span class="co"># coefficient to start the simulation to generate data</span>
     dpar1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">4.8</span>, <span class="fl">1.8</span>, sderr)  <span class="co"># all the parameters in all : mean and sd of the biomarker and sd of the error</span>
     dpar2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">4.8</span>, <span class="fl">3.24</span>)       <span class="co"># mean and variance of the bimarker</span>

 <span class="co"># generate data</span>
        mydat &lt;-<span class="st"> </span><span class="kw">datgen</span>(<span class="dv">500</span>, <span class="dv">300</span>, coff, dpar1) <span class="co"># generate 500 data set each with 300 sample size</span>
        <span class="kw">head</span>(mydat[[<span class="dv">1</span>]])                    <span class="co"># print the first 10 observation from the first data set</span></code></pre></div>
<pre><code>##   outcome1 A       xx       ww       xnew       Z1       Z2        Z3
## 1        0 1 4.655714 5.979087  7.2982516 4.655714 5.979087 7.2982516
## 2        1 0 7.611214 8.456264 12.5468944 0.000000 0.000000 0.0000000
## 3        1 1 3.553381 3.561235  2.1753028 3.553381 3.561235 2.1753028
## 4        1 1 2.878390 2.965110  0.9122341 2.878390 2.965110 0.9122341
## 5        0 0 6.235685 6.229134  7.8280510 0.000000 0.000000 0.0000000
## 6        1 1 5.791111 5.751638  6.8163322 5.791111 5.751638 6.8163322</code></pre>
</div>
<div id="estimating-delta_r" class="section level2">
<h2>Estimating <span class="math inline">\(\Delta_r\)</span></h2>
<p>Assuming we already have generated data as in the above procedure, or we have our own reproducibility data, estimatig of <span class="math inline">\(\Delta_r\)</span> can proceed in the following manner:</p>
<div id="estimate-theta_gs" class="section level3">
<h3>Estimate <span class="math inline">\(\Theta_{gs}\)</span></h3>
<p>Assuming the observed biomarker is the gold standard, the metric <span class="math inline">\(\Theta\)</span> which measures the decrease in the expected proportion of unfavorable even under the biomarker guided treatment is estimated as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate theta from the gold standard assay</span>

 casex1 &lt;-<span class="st"> </span><span class="kw">lapply</span>(mydat, thetags, dpar2)
 casex2 &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, casex1)
 thetax &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">round</span>(<span class="kw">colMeans</span>(casex2), <span class="dt">digits =</span> <span class="dv">3</span>))
 thetax</code></pre></div>
<pre><code>## [1] 0.247</code></pre>
</div>
<div id="estimate-theta_mod" class="section level3">
<h3>Estimate <span class="math inline">\(\Theta_{mod}\)</span></h3>
<p>Assuming the observed biomarker is the modified assay, the metric <span class="math inline">\(\Theta\)</span> which measures the decrease in the expected proportion of unfavorable even under the biomarker guided treatment is estimated as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate theta from modified assay</span>
casemc1 &lt;-<span class="st"> </span><span class="kw">lapply</span>(mydat, thetama)
 casemc2 &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, casemc1)
 thetamod &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">round</span>(<span class="kw">colMeans</span>(casemc2), <span class="dt">digits =</span> <span class="dv">3</span>))
 thetamod</code></pre></div>
<pre><code>## [1] 0.223</code></pre>
<p>Finally we can get an estimate of the reproducibility metric <span class="math inline">\(\Delta_R\)</span> as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="co"># estimating delta</span>

 delta10 &lt;-<span class="st"> </span><span class="kw">lapply</span>(mydat, delta4r, dpar2)
 delta10 &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, delta10)
 delta11 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">round</span>(<span class="kw">colMeans</span>(delta10), <span class="dt">digits =</span> <span class="dv">3</span>))
 delta11</code></pre></div>
<pre><code>## [1] 0.024</code></pre>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
